{"version":3,"file":"sub.vue_vue_type_script_setup_true_lang-DcautzO2.js","sources":["../../src/layouts/components/MenuPanel/sub.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport type { SubMenuProps } from './types'\nimport { useTimeoutFn } from '@vueuse/core'\nimport Item from './item.vue'\nimport { rootMenuInjectionKey } from './types'\n\ndefineOptions({\n  name: 'SubMenu',\n})\n\nconst props = withDefaults(\n  defineProps<SubMenuProps>(),\n  {\n    level: 0,\n  },\n)\n\nconst index = props.menu.path ?? JSON.stringify(props.menu)\nconst itemRef = useTemplateRef('itemRef')\nconst subMenuRef = useTemplateRef('subMenuRef')\nconst rootMenu = inject(rootMenuInjectionKey)!\n\nconst opened = computed(() => {\n  return rootMenu.openedMenus.includes(props.uniqueKey.at(-1)!)\n})\n\nconst transitionEvent = {\n  enter(el: HTMLElement) {\n    if (el.offsetHeight > window.innerHeight) {\n      el.style.height = `${window.innerHeight}px`\n    }\n  },\n  afterEnter: () => {},\n  beforeLeave: (el: HTMLElement) => {\n    el.style.overflow = 'hidden'\n    el.style.maxHeight = `${el.offsetHeight}px`\n  },\n  leave: (el: HTMLElement) => {\n    el.style.maxHeight = '0'\n  },\n  afterLeave(el: HTMLElement) {\n    el.style.overflow = ''\n    el.style.maxHeight = ''\n  },\n}\n\nconst transitionClass = {\n  enterActiveClass: 'ease-in-out duration-300',\n  enterFromClass: 'opacity-0 translate-x-4',\n  enterToClass: 'opacity-100',\n  leaveActiveClass: 'ease-in-out duration-300',\n  leaveFromClass: 'opacity-100',\n  leaveToClass: 'opacity-0',\n}\n\nconst hasChildren = computed(() => {\n  let flag = true\n  if (props.menu.children) {\n    if (props.menu.children.every((item: any) => item.meta?.menu === false)) {\n      flag = false\n    }\n  }\n  else {\n    flag = false\n  }\n  return flag\n})\n\nfunction handleClick() {\n  if (hasChildren.value) {\n    return\n  }\n  rootMenu.handleMenuItemClick(index)\n}\n\nlet timeout: (() => void) | undefined\n\nfunction handleMouseenter() {\n  if (props.level !== 0) {\n    return\n  }\n  rootMenu.mouseInMenu = props.uniqueKey\n  timeout?.()\n  ;({ stop: timeout } = useTimeoutFn(() => {\n    if (hasChildren.value) {\n      rootMenu.openMenu(index)\n      nextTick(() => {\n        const el = itemRef.value?.ref\n        const subMenuEl = subMenuRef.value?.$el\n        if (!el || !subMenuEl) {\n          return\n        }\n        let top = 0\n        let left = 0\n        if (rootMenu.props.mode === 'vertical' || props.level !== 0) {\n          top = el.getBoundingClientRect().top + el.scrollTop\n          left = (rootMenu.props.direction === 'ltr' ? el.getBoundingClientRect().left : document.documentElement.clientWidth - el.getBoundingClientRect().right) + el.getBoundingClientRect().width\n          if (top + subMenuEl.offsetHeight > window.innerHeight) {\n            top = window.innerHeight - subMenuEl.offsetHeight\n          }\n        }\n        else {\n          top = el.getBoundingClientRect().top + el.getBoundingClientRect().height\n          left = rootMenu.props.direction === 'ltr' ? el.getBoundingClientRect().left : document.documentElement.clientWidth - el.getBoundingClientRect().right\n          if (top + subMenuEl.offsetHeight > window.innerHeight) {\n            subMenuEl.style.height = `${window.innerHeight - top}px`\n          }\n          if (left + subMenuEl.offsetWidth > document.documentElement.clientWidth) {\n            left = document.documentElement.clientWidth - subMenuEl.offsetWidth\n          }\n        }\n        subMenuEl.style.top = `${top}px`\n        subMenuEl.style.insetInlineStart = `${left}px`\n      })\n    }\n    else {\n      const path = props.menu.children ? rootMenu.subMenus[index].indexPath.at(-1)! : rootMenu.items[index].indexPath.at(-1)!\n      rootMenu.openMenu(path)\n    }\n  }, 300))\n}\n\nfunction handleMouseleave() {\n  if (props.level !== 0) {\n    return\n  }\n  rootMenu.mouseInMenu = []\n  timeout?.()\n  ;({ stop: timeout } = useTimeoutFn(() => {\n    if (rootMenu.mouseInMenu.length === 0) {\n      rootMenu.closeMenu(props.uniqueKey)\n    }\n    else {\n      if (hasChildren.value) {\n        !rootMenu.mouseInMenu.includes(props.uniqueKey.at(-1)!) && rootMenu.closeMenu(props.uniqueKey.at(-1)!)\n      }\n    }\n  }, 300))\n}\n\nfunction handlePanelMouseenter() {\n  timeout?.()\n}\n</script>\n\n<template>\n  <Item ref=\"itemRef\" :unique-key=\"uniqueKey\" :item=\"menu\" :level=\"level\" :sub-menu=\"hasChildren\" @click=\"handleClick\" @mouseenter=\"handleMouseenter\" @mouseleave=\"handleMouseleave\" />\n  <Teleport v-if=\"hasChildren\" to=\"body\" :disabled=\"level !== 0\">\n    <Transition v-if=\"level === 0\" v-bind=\"transitionClass\" v-on=\"transitionEvent\">\n      <FaScrollArea v-show=\"opened\" ref=\"subMenuRef\" mask class=\"sub-menu z-3000 w-150 border rounded-lg bg-[var(--g-sub-sidebar-bg)] shadow-xl fixed! 2xl:w-200\" @mouseenter=\"handlePanelMouseenter\" @mouseleave=\"handleMouseleave\">\n        <div class=\"columns-3 p-2 px-3 2xl:columns-4\">\n          <div v-for=\"item in menu.children\" :key=\"item.path ?? JSON.stringify(item)\" class=\"w-full break-inside-avoid\">\n            <SubMenu v-if=\"item.meta?.menu !== false\" :unique-key=\"[...uniqueKey, item.path ?? JSON.stringify(item)]\" :menu=\"item\" :level=\"level + 1\" />\n          </div>\n        </div>\n      </FaScrollArea>\n    </Transition>\n    <template v-else>\n      <template v-for=\"item in menu.children\" :key=\"item.path ?? JSON.stringify(item)\">\n        <SubMenu v-if=\"item.meta?.menu !== false\" :unique-key=\"[...uniqueKey, item.path ?? JSON.stringify(item)]\" :menu=\"item\" :level=\"level + 1\" />\n      </template>\n    </template>\n  </Teleport>\n</template>\n"],"names":["props","__props","index","itemRef","useTemplateRef","subMenuRef","rootMenu","inject","rootMenuInjectionKey","opened","computed","transitionEvent","el","transitionClass","hasChildren","flag","item","_a","handleClick","timeout","handleMouseenter","useTimeoutFn","nextTick","subMenuEl","_b","top","left","path","handleMouseleave","handlePanelMouseenter"],"mappings":"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"}