{"version":3,"file":"moreAction-pwQ77foV.js","sources":["../../src/layouts/components/Topbar/Tabbar/moreAction.vue"],"sourcesContent":["<i18n lang=\"yaml\">\nzh-cn:\n  searchPlaceholder: 搜索...\n  searchTabs: 搜索标签页\n  closeOtherSide: 关闭其它标签页\n  closeLeftSide: 关闭左侧标签页\n  closeRightSide: 关闭右侧标签页\nzh-tw:\n  searchPlaceholder: 搜索...\n  searchTabs: 搜索標籤頁\n  closeOtherSide: 關閉其它標籤頁\n  closeLeftSide: 關閉左側標籤頁\n  closeRightSide: 關閉右側標籤頁\nen:\n  searchPlaceholder: Search...\n  searchTabs: Search Tabs\n  closeOtherSide: Close Otherside Tabs\n  closeLeftSide: Close Leftside Tabs\n  closeRightSide: Close Rightside Tabs\n</i18n>\n\n<script setup lang=\"ts\">\nimport type { Tabbar } from '#/global'\nimport useSettingsStore from '@/store/modules/settings'\nimport useTabbarStore from '@/store/modules/tabbar'\nimport { match } from 'pinyin-pro'\nimport Sortable from 'sortablejs'\nimport { useI18n } from 'vue-i18n'\n\ndefineOptions({\n  name: 'TabbarMoreAction',\n})\n\nconst router = useRouter()\n\nconst settingsStore = useSettingsStore()\nconst tabbarStore = useTabbarStore()\n\nconst tabbar = useTabbar()\n\nconst { t } = useI18n()\nconst { generateI18nTitle } = useMenu()\n\nconst open = ref(false)\n\nconst enableSearch = ref(false)\nconst searchInput = ref('')\nconst searchInputRef = useTemplateRef('searchInputRef')\nwatch(() => enableSearch.value, (val) => {\n  if (val) {\n    nextTick(() => {\n      searchInputRef.value?.focus()\n    })\n  }\n  else {\n    searchInput.value = ''\n  }\n})\n\nconst resultList = computed(() => {\n  let result = []\n  result = tabbarStore.list.filter((item) => {\n    let flag = false\n    if (\n      generateI18nTitle(item.title).toString().includes(searchInput.value)\n      || (match(generateI18nTitle(item.title).toString(), searchInput.value, { continuous: true })?.length ?? 0) > 0\n    ) {\n      flag = true\n    }\n    return flag\n  })\n  return result\n})\n\nconst activedTabId = computed(() => tabbar.getId())\n\nconst dropdownTabContainerRef = useTemplateRef('dropdownTabContainerRef')\n\nconst isDragging = ref(false)\nlet tabSortable: Sortable\nwatch(() => dropdownTabContainerRef.value, (val) => {\n  if (val) {\n    tabSortable = new Sortable(val, {\n      animation: 200,\n      ghostClass: 'opacity-0',\n      draggable: '.tab',\n      onStart: () => {\n        isDragging.value = true\n      },\n      onEnd: () => {\n        isDragging.value = false\n      },\n      onMove: (e) => {\n        return e.dragged.classList.contains('pinned') ? e.related.classList.contains('pinned') : !e.related.classList.contains('pinned')\n      },\n      onUpdate: (e) => {\n        if (e.newIndex !== undefined && e.oldIndex !== undefined) {\n          tabbarStore.sort(e.newIndex, e.oldIndex)\n        }\n      },\n    })\n    if (settingsStore.mode === 'mobile') {\n      tabSortable.option('disabled', true)\n    }\n  }\n  else {\n    tabSortable.destroy()\n  }\n})\nwatch(() => enableSearch.value, (val) => {\n  nextTick(() => {\n    tabSortable.option('disabled', val)\n  })\n})\n\nfunction iconName(isActive: boolean, icon: Tabbar.recordRaw['icon'], activeIcon: Tabbar.recordRaw['activeIcon']) {\n  let name\n  if ((!isActive && icon) || (isActive && !activeIcon)) {\n    name = icon\n  }\n  else if (isActive && activeIcon) {\n    name = activeIcon\n  }\n  return name\n}\n\nfunction handleClick(fullPath: string) {\n  router.push(fullPath)\n  open.value = false\n}\n</script>\n\n<template>\n  <div>\n    <FaPopover v-model:open=\"open\" class=\"min-w-auto p-0\" align=\"end\">\n      <FaButton variant=\"outline\" size=\"icon\" class=\"h-7 w-7\">\n        <FaIcon name=\"i-ep:caret-bottom\" />\n      </FaButton>\n      <template #panel>\n        <div class=\"max-h-[320px] w-[200px] flex flex-col\">\n          <div class=\"flex-center-between gap-2 p-4\">\n            <template v-if=\"enableSearch\">\n              <input ref=\"searchInputRef\" v-model=\"searchInput\" :placeholder=\"t('searchPlaceholder')\" class=\"h-8 w-0 flex-1 border border-input rounded-md bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none\">\n              <FaButton variant=\"outline\" size=\"icon\" class=\"h-8 w-8\" @click=\"enableSearch = false\">\n                <FaIcon name=\"i-ri:close-fill\" class=\"size-4\" />\n              </FaButton>\n            </template>\n            <template v-else>\n              <FaTooltip :text=\"t('searchTabs')\">\n                <FaButton v-if=\"settingsStore.settings.toolbar.navSearch\" variant=\"secondary\" size=\"icon\" class=\"h-8 w-8\" @click=\"enableSearch = true\">\n                  <FaIcon name=\"i-ri:search-line\" class=\"size-4\" />\n                </FaButton>\n              </FaTooltip>\n              <FaTooltip :text=\"t('closeOtherSide')\">\n                <FaButton variant=\"secondary\" size=\"icon\" class=\"h-8 w-8\" :disabled=\"!tabbar.checkCloseOtherSide()\" @click=\"tabbar.closeOtherSide()\">\n                  <FaIcon name=\"i-ri:close-fill\" class=\"size-4\" />\n                </FaButton>\n              </FaTooltip>\n              <FaTooltip :text=\"t('closeLeftSide')\">\n                <FaButton variant=\"secondary\" size=\"icon\" class=\"h-8 w-8\" :disabled=\"!tabbar.checkCloseLeftSide()\" @click=\"tabbar.closeLeftSide()\">\n                  <FaIcon name=\"i-ph:arrow-line-left\" class=\"size-4\" />\n                </FaButton>\n              </FaTooltip>\n              <FaTooltip :text=\"t('closeRightSide')\">\n                <FaButton variant=\"secondary\" size=\"icon\" class=\"h-8 w-8\" :disabled=\"!tabbar.checkCloseRightSide()\" @click=\"tabbar.closeRightSide()\">\n                  <FaIcon name=\"i-ph:arrow-line-right\" class=\"size-4\" />\n                </FaButton>\n              </FaTooltip>\n            </template>\n          </div>\n          <FaScrollArea :scrollbar=\"false\" mask gradient-color=\"hsl(var(--popover))\" class=\"mb-4 flex-1 -mt-2\">\n            <div ref=\"dropdownTabContainerRef\" class=\"tabs space-y-1\" :class=\"{ dragging: isDragging }\">\n              <div\n                v-for=\"element in resultList\" :key=\"settingsStore.settings.tabbar.mergeTabsBy === 'routeName' && element.routeName ? element.routeName : element.tabId\" class=\"relative mx-4 h-8 rounded-md px-2 tab\" :class=\"{\n                  'bg-accent': element.tabId === activedTabId,\n                  'pinned': element.isPermanent || element.isPin,\n                }\"\n              >\n                <div :key=\"element.tabId\" class=\"title\" :title=\"element.customTitleList.find(item => item.fullPath === element.fullPath)?.title || generateI18nTitle(element.title)\" @click=\"handleClick(element.fullPath)\">\n                  <FaIcon v-if=\"settingsStore.settings.tabbar.enableIcon && iconName(element.tabId === activedTabId, element.icon, element.activeIcon)\" :name=\"iconName(element.tabId === activedTabId, element.icon, element.activeIcon)!\" />\n                  {{ element.customTitleList.find(item => item.fullPath === element.fullPath)?.title || generateI18nTitle(element.title) }}\n                </div>\n                <div v-if=\"!element.isPermanent && element.isPin\" class=\"action-icon\" @click.stop=\"tabbarStore.unPin(element.tabId)\" @dblclick.stop>\n                  <FaIcon name=\"i-ri:pushpin-2-fill\" />\n                </div>\n                <div v-else-if=\"!element.isPermanent && resultList.length > 1\" class=\"action-icon\" @click.stop=\"tabbar.closeById(element.tabId)\" @dblclick.stop>\n                  <FaIcon name=\"i-ri:close-fill\" />\n                </div>\n              </div>\n            </div>\n          </FaScrollArea>\n        </div>\n      </template>\n    </FaPopover>\n  </div>\n</template>\n\n<style scoped>\n.tabs {\n  &:not(.dragging) {\n    .tab:hover {\n      &:not(.actived) {\n        --uno: bg-accent;\n      }\n\n      .action-icon {\n        opacity: 1;\n      }\n    }\n  }\n\n  .tab {\n    transition: background-color 0.3s;\n\n    &:hover {\n      .title {\n        --uno: opacity-100;\n\n        margin-inline-end: 20px;\n        mask-image: linear-gradient(to right, #000 calc(100% - 44px), transparent);\n\n        [dir=\"rtl\"] & {\n          mask-image: linear-gradient(to left, #000 calc(100% - 44px), transparent);\n        }\n      }\n    }\n\n    * {\n      user-select: none;\n    }\n\n    .title {\n      --uno: opacity-70 transition;\n\n      position: relative;\n      display: flex;\n      gap: 5px;\n      align-items: center;\n      height: 100%;\n      overflow: hidden;\n      font-size: 14px;\n      white-space: nowrap;\n      cursor: pointer;\n      mask-image: linear-gradient(to right, #000 calc(100% - 24px), transparent);\n\n      [dir=\"rtl\"] & {\n        mask-image: linear-gradient(to left, #000 calc(100% - 24px), transparent);\n      }\n\n      i {\n        flex-shrink: 0;\n        font-size: 16px;\n      }\n    }\n\n    .action-icon {\n      --uno: transition absolute inset-e-2 top-1/2 -translate-y-1/2 rounded-full z-10 w-5 h-5 flex-center text-xs \"text-[var(--g-tabbar-tab-color)]\" op-0 hover:border hover:bg-secondary;\n    }\n  }\n}\n</style>\n"],"names":["router","useRouter","settingsStore","useSettingsStore","tabbarStore","useTabbarStore","tabbar","useTabbar","t","useI18n","generateI18nTitle","useMenu","open","ref","enableSearch","searchInput","searchInputRef","useTemplateRef","watch","val","nextTick","_a","resultList","computed","result","item","flag","match","activedTabId","dropdownTabContainerRef","isDragging","tabSortable","Sortable","iconName","isActive","icon","activeIcon","name","handleClick","fullPath"],"mappings":"2xBAiCA,MAAMA,EAASC,EAAU,EAEnBC,EAAgBC,EAAiB,EACjCC,EAAcC,EAAe,EAE7BC,EAASC,GAAU,EAEnB,CAAE,EAAAC,CAAE,EAAIC,EAAQ,EAChB,CAAE,kBAAAC,CAAkB,EAAIC,GAAQ,EAEhCC,EAAOC,EAAI,EAAK,EAEhBC,EAAeD,EAAI,EAAK,EACxBE,EAAcF,EAAI,EAAE,EACpBG,EAAiBC,EAAe,gBAAgB,EACtDC,EAAM,IAAMJ,EAAa,MAAQK,GAAQ,CACnCA,EACFC,EAAS,IAAM,QACbC,EAAAL,EAAe,QAAf,MAAAK,EAAsB,OAAM,CAC7B,EAGDN,EAAY,MAAQ,EACtB,CACD,EAEK,MAAAO,EAAaC,EAAS,IAAM,CAChC,IAAIC,EAAS,CAAC,EACd,OAAAA,EAASpB,EAAY,KAAK,OAAQqB,GAAS,OACzC,IAAIC,EAAO,GAET,OAAAhB,EAAkBe,EAAK,KAAK,EAAE,SAAA,EAAW,SAASV,EAAY,KAAK,MAC/DM,EAAAM,GAAMjB,EAAkBe,EAAK,KAAK,EAAE,WAAYV,EAAY,MAAO,CAAE,WAAY,GAAM,IAAvF,YAAAM,EAA0F,SAAU,GAAK,KAEtGK,EAAA,IAEFA,CAAA,CACR,EACMF,CAAA,CACR,EAEKI,EAAeL,EAAS,IAAMjB,EAAO,OAAO,EAE5CuB,EAA0BZ,EAAe,yBAAyB,EAElEa,EAAajB,EAAI,EAAK,EACxB,IAAAkB,EACJb,EAAM,IAAMW,EAAwB,MAAQV,GAAQ,CAC9CA,GACYY,EAAA,IAAIC,GAASb,EAAK,CAC9B,UAAW,IACX,WAAY,YACZ,UAAW,OACX,QAAS,IAAM,CACbW,EAAW,MAAQ,EACrB,EACA,MAAO,IAAM,CACXA,EAAW,MAAQ,EACrB,EACA,OAAS,GACA,EAAE,QAAQ,UAAU,SAAS,QAAQ,EAAI,EAAE,QAAQ,UAAU,SAAS,QAAQ,EAAI,CAAC,EAAE,QAAQ,UAAU,SAAS,QAAQ,EAEjI,SAAW,GAAM,CACX,EAAE,WAAa,QAAa,EAAE,WAAa,QAC7C1B,EAAY,KAAK,EAAE,SAAU,EAAE,QAAQ,CACzC,CACF,CACD,EACGF,EAAc,OAAS,UACb6B,EAAA,OAAO,WAAY,EAAI,GAIrCA,EAAY,QAAQ,CACtB,CACD,EACDb,EAAM,IAAMJ,EAAa,MAAQK,GAAQ,CACvCC,EAAS,IAAM,CACDW,EAAA,OAAO,WAAYZ,CAAG,CAAA,CACnC,CAAA,CACF,EAEQ,SAAAc,EAASC,EAAmBC,EAAgCC,EAA4C,CAC3G,IAAAC,EACJ,MAAK,CAACH,GAAYC,GAAUD,GAAY,CAACE,EAChCC,EAAAF,EAEAD,GAAYE,IACZC,EAAAD,GAEFC,CAAA,CAGT,SAASC,EAAYC,EAAkB,CACrCvC,EAAO,KAAKuC,CAAQ,EACpB3B,EAAK,MAAQ,EAAA"}