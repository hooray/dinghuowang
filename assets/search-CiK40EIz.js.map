{"version":3,"file":"search-CiK40EIz.js","sources":["../../src/layouts/components/Topbar/Toolbar/NavSearch/search.vue"],"sourcesContent":["<i18n lang=\"yaml\">\nzh-cn:\n  input: 支持标题、拼音(首字母)、URL模糊查询\n  welcome: 输入你要搜索的导航\n  empty: 没有找到你想要的\n  up_down: 切换\n  enter: 访问\n  esc: 退出\nzh-tw:\n  input: 支持標題、拼音(首字母)、URL模糊查詢\n  welcome: 輸入你要搜索的導航\n  empty: 沒有找到你想要的\n  up_down: 切換\n  enter: 訪問\n  esc: 退出\nen:\n  input: Support title, URL fuzzy query\n  welcome: Enter the navigation you want to search\n  empty: Not found\n  up_down: Choice\n  enter: Enter\n  esc: Exit\n</i18n>\n\n<script setup lang=\"ts\">\nimport type { Menu } from '#/global'\nimport Breadcrumb from '@/layouts/components/Breadcrumb/index.vue'\nimport BreadcrumbItem from '@/layouts/components/Breadcrumb/item.vue'\nimport useMenuStore from '@/store/modules/menu'\nimport useRouteStore from '@/store/modules/route'\nimport useSettingsStore from '@/store/modules/settings'\nimport { resolveRoutePath } from '@/utils'\nimport { useFocus } from '@vueuse/core'\nimport hotkeys from 'hotkeys-js'\nimport { match } from 'pinyin-pro'\nimport { useI18n } from 'vue-i18n'\n\ndefineOptions({\n  name: 'Search',\n})\n\nconst isShow = defineModel<boolean>({\n  default: false,\n})\n\nconst { t } = useI18n()\n\nconst router = useRouter()\nconst settingsStore = useSettingsStore()\nconst routeStore = useRouteStore()\nconst menuStore = useMenuStore()\n\nconst { generateI18nTitle } = useMenu()\n\ninterface listTypes {\n  path: string\n  query?: Record<string, any>\n  icon?: string\n  title?: string | (() => string)\n  link?: string\n}\n\nconst searchInput = ref('')\nconst searchInputRef = useTemplateRef('searchInputRef')\nconst { focused: searchInputFocused } = useFocus(searchInputRef)\nconst sourceList = ref<listTypes[]>([])\nconst actived = ref(-1)\n\nconst searchResultRef = useTemplateRef('searchResultRef')\nconst searchResultItemRef = useTemplateRef<HTMLElement[]>('searchResultItemRef')\n\nconst resultList = computed(() => {\n  let result = []\n  result = sourceList.value.filter((item) => {\n    let flag = false\n    if (searchInput.value !== '') {\n      if (item.path.includes(searchInput.value)) {\n        flag = true\n      }\n      if (\n        generateI18nTitle(item.title).toString().includes(searchInput.value)\n        || (match(generateI18nTitle(item.title).toString(), searchInput.value, { continuous: true })?.length ?? 0) > 0\n      ) {\n        flag = true\n      }\n      if (routeStore.getRouteMatchedByPath(item.path).some((b) => {\n        return generateI18nTitle(b.meta?.title).toString().includes(searchInput.value)\n          || (match(generateI18nTitle(b.meta?.title).toString(), searchInput.value, { continuous: true })?.length ?? 0) > 0\n      })) {\n        flag = true\n      }\n    }\n    return flag\n  })\n  return result\n})\n\nwatch(() => isShow.value, (val) => {\n  if (val) {\n    searchInput.value = ''\n    actived.value = -1\n    // 当搜索显示的时候绑定上、下、回车快捷键，隐藏的时候再解绑。另外当 input 处于 focus 状态时，采用 vue 来绑定键盘事件\n    hotkeys('up', keyUp)\n    hotkeys('down', keyDown)\n    hotkeys('enter', keyEnter)\n    hotkeys('esc', (e) => {\n      if (settingsStore.settings.navSearch.enableHotkeys) {\n        e.preventDefault()\n        isShow.value = false\n      }\n    })\n  }\n  else {\n    hotkeys.unbind('up', keyUp)\n    hotkeys.unbind('down', keyDown)\n    hotkeys.unbind('enter', keyEnter)\n    hotkeys.unbind('esc')\n  }\n})\nwatch(() => resultList.value, () => {\n  actived.value = -1\n  handleScroll()\n})\n\nonMounted(() => {\n  initSourceList()\n  hotkeys('command+k, ctrl+k', (e) => {\n    if (settingsStore.settings.navSearch.enableHotkeys) {\n      e.preventDefault()\n      isShow.value = true\n    }\n  })\n})\n\nonUnmounted(() => {\n  hotkeys.unbind('command+k, ctrl+k')\n})\n\nfunction initSourceList() {\n  sourceList.value = []\n  menuStore.allMenus.forEach((item) => {\n    getSourceList(item.children)\n  })\n}\n\nfunction hasChildren(item: Menu.recordRaw) {\n  let flag = true\n  if (item.children?.every(i => i.meta?.menu === false)) {\n    flag = false\n  }\n  return flag\n}\nfunction getSourceList(arr: Menu.recordRaw[], basePath?: string, icon?: string) {\n  arr.forEach((item) => {\n    if (item.meta?.menu !== false) {\n      if (item.children && hasChildren(item)) {\n        getSourceList(item.children, resolveRoutePath(basePath, item.path), item.meta?.icon ?? icon)\n      }\n      else {\n        sourceList.value.push({\n          path: resolveRoutePath(basePath, item.path),\n          query: item.meta?.query,\n          icon: item.meta?.icon ?? icon,\n          title: item.meta?.title,\n          link: item.meta?.link,\n        })\n      }\n    }\n  })\n}\n\nfunction keyUp() {\n  if (resultList.value.length) {\n    actived.value -= 1\n    if (actived.value < 0) {\n      actived.value = resultList.value.length - 1\n    }\n    handleScroll()\n  }\n}\nfunction keyDown() {\n  if (resultList.value.length) {\n    actived.value += 1\n    if (actived.value > resultList.value.length - 1) {\n      actived.value = 0\n    }\n    handleScroll()\n  }\n}\nfunction keyEnter() {\n  if (actived.value !== -1) {\n    searchResultItemRef.value?.find(item => Number.parseInt(item.dataset.index!) === actived.value)?.click()\n  }\n}\nfunction handleScroll() {\n  if (searchResultRef.value?.areaRef?.ref?.el?.viewportElement) {\n    const contentDom = searchResultRef.value.areaRef.ref.el.viewportElement\n    let scrollTo = 0\n    if (actived.value !== -1) {\n      scrollTo = contentDom.scrollTop\n      const activedOffsetTop = searchResultItemRef.value?.find(item => Number.parseInt(item.dataset.index!) === actived.value)?.offsetTop ?? 0\n      const activedClientHeight = searchResultItemRef.value?.find(item => Number.parseInt(item.dataset.index!) === actived.value)?.clientHeight ?? 0\n      const searchScrollTop = contentDom.scrollTop\n      const searchClientHeight = contentDom.clientHeight\n      if (activedOffsetTop + activedClientHeight > searchScrollTop + searchClientHeight) {\n        scrollTo = activedOffsetTop + activedClientHeight - searchClientHeight\n      }\n      else if (activedOffsetTop <= searchScrollTop) {\n        scrollTo = activedOffsetTop - 16\n      }\n    }\n    contentDom.scrollTo({\n      top: scrollTo,\n    })\n  }\n}\n\nfunction pageJump(path: listTypes['path'], query: listTypes['query'], link: listTypes['link']) {\n  if (link) {\n    window.open(link, '_blank')\n  }\n  else {\n    router.push({\n      path,\n      query,\n    })\n  }\n  isShow.value = false\n}\n</script>\n\n<template>\n  <FaModal ref=\"searchResultRef\" v-model=\"isShow\" border :footer=\"settingsStore.mode === 'pc'\" :closable=\"false\" class=\"w-full lg-max-w-2xl\" content-class=\"flex flex-col p-0 min-h-auto\" header-class=\"p-0\" footer-class=\"p-0\" @opened=\"searchInputFocused = true\">\n    <template #header>\n      <div class=\"h-12 flex flex-shrink-0 items-center\">\n        <div class=\"h-full w-14 flex-center\">\n          <FaIcon name=\"i-ri:search-line\" class=\"size-4 text-foreground/30\" />\n        </div>\n        <input ref=\"searchInputRef\" v-model=\"searchInput\" :placeholder=\"t('input')\" class=\"h-full w-full border-0 rounded-md bg-transparent text-base text-foreground focus-outline-none placeholder-foreground/30\" @keydown.esc.prevent=\"isShow = false\" @keydown.up.prevent=\"keyUp\" @keydown.down.prevent=\"keyDown\" @keydown.enter.prevent=\"keyEnter\">\n        <div v-if=\"settingsStore.mode === 'mobile'\" class=\"h-full w-14 flex-center border-s\">\n          <FaIcon name=\"i-carbon:close\" class=\"size-4\" @click=\"isShow = false\" />\n        </div>\n      </div>\n    </template>\n    <template #footer>\n      <div class=\"w-full flex justify-between px-4 py-3\">\n        <div class=\"flex gap-8\">\n          <div class=\"inline-flex items-center gap-1 text-xs\">\n            <FaKbd>\n              <FaIcon name=\"i-ion:md-return-left\" class=\"size-4\" />\n            </FaKbd>\n            <span>{{ t('enter') }}</span>\n          </div>\n          <div class=\"inline-flex items-center gap-1 text-xs\">\n            <FaKbd>\n              <FaIcon name=\"i-ant-design:caret-up-filled\" class=\"size-4\" />\n            </FaKbd>\n            <FaKbd>\n              <FaIcon name=\"i-ant-design:caret-down-filled\" class=\"size-4\" />\n            </FaKbd>\n            <span>{{ t('up_down') }}</span>\n          </div>\n        </div>\n        <div v-if=\"settingsStore.settings.navSearch.enableHotkeys\" class=\"inline-flex items-center gap-1 text-xs\">\n          <FaKbd>\n            ESC\n          </FaKbd>\n          <span>{{ t('esc') }}</span>\n        </div>\n      </div>\n    </template>\n    <div>\n      <template v-if=\"resultList.length > 0\">\n        <div v-for=\"(item, index) in resultList\" ref=\"searchResultItemRef\" :key=\"item.path\" class=\"p-4\" :data-index=\"index\" @click=\"pageJump(item.path, item.query, item.link)\" @mouseover=\"actived = index\">\n          <a class=\"flex cursor-pointer items-center border rounded-lg\" :class=\"{ '-mt-4': index !== 0, 'bg-accent': index === actived }\">\n            <FaIcon v-if=\"item.icon\" :name=\"item.icon\" class=\"size-5 basis-16 transition\" :class=\"{ 'scale-120 text-primary': index === actived }\" />\n            <div class=\"flex flex-1 flex-col gap-1 truncate border-s px-4 py-3\">\n              <div class=\"truncate text-start text-base font-bold\">{{ generateI18nTitle(item.title) }}</div>\n              <Breadcrumb v-if=\"routeStore.getRouteMatchedByPath(item.path).length\" class=\"truncate\">\n                <BreadcrumbItem v-for=\"(bc, bcIndex) in routeStore.getRouteMatchedByPath(item.path)\" :key=\"bcIndex\" class=\"text-xs\">\n                  {{ generateI18nTitle(bc.meta?.title) }}\n                </BreadcrumbItem>\n              </Breadcrumb>\n            </div>\n          </a>\n        </div>\n      </template>\n      <template v-else-if=\"searchInput === ''\">\n        <div class=\"h-full flex-col-center py-6 text-secondary-foreground/50\">\n          <FaIcon name=\"i-tabler:mood-smile\" class=\"size-10\" />\n          <p class=\"m-2 text-base\">\n            {{ t('welcome') }}\n          </p>\n        </div>\n      </template>\n      <template v-else>\n        <div class=\"h-full flex-col-center py-6 text-secondary-foreground/50\">\n          <FaIcon name=\"i-tabler:mood-empty\" class=\"size-10\" />\n          <p class=\"m-2 text-base\">\n            {{ t('empty') }}\n          </p>\n        </div>\n      </template>\n    </div>\n  </FaModal>\n</template>\n"],"names":["isShow","_useModel","__props","t","useI18n","router","useRouter","settingsStore","useSettingsStore","routeStore","useRouteStore","menuStore","useMenuStore","generateI18nTitle","useMenu","searchInput","ref","searchInputRef","useTemplateRef","searchInputFocused","useFocus","sourceList","actived","searchResultRef","searchResultItemRef","resultList","computed","result","item","flag","_a","match","b","_c","_b","watch","val","hotkeys","keyUp","keyDown","keyEnter","handleScroll","onMounted","initSourceList","e","onUnmounted","getSourceList","hasChildren","i","arr","basePath","icon","resolveRoutePath","_d","_e","_f","contentDom","scrollTo","activedOffsetTop","activedClientHeight","_h","_g","searchScrollTop","searchClientHeight","pageJump","path","query","link"],"mappings":"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"}