{"version":3,"file":"sub.vue_vue_type_script_setup_true_lang-BAaA2YAV.js","sources":["../../src/layouts/components/Menu/sub.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport type { SubMenuProps } from './types'\nimport { useTimeoutFn } from '@vueuse/core'\nimport Item from './item.vue'\nimport { rootMenuInjectionKey } from './types'\n\ndefineOptions({\n  name: 'SubMenu',\n})\n\nconst props = withDefaults(\n  defineProps<SubMenuProps>(),\n  {\n    level: 0,\n  },\n)\n\nconst index = props.menu.path ?? JSON.stringify(props.menu)\nconst itemRef = useTemplateRef('itemRef')\nconst subMenuRef = useTemplateRef('subMenuRef')\nconst rootMenu = inject(rootMenuInjectionKey)!\n\nconst opened = computed(() => {\n  return rootMenu.openedMenus.includes(props.uniqueKey.at(-1)!)\n})\nconst alwaysOpened = computed(() => {\n  return rootMenu.alwaysOpenedsMenus.includes(props.uniqueKey.at(-1)!)\n})\n\nconst transitionEvent = computed(() => {\n  return rootMenu.isMenuPopup\n    ? {\n        enter(el: HTMLElement) {\n          if (el.offsetHeight > window.innerHeight) {\n            el.style.height = `${window.innerHeight}px`\n          }\n        },\n        afterEnter: () => {},\n        beforeLeave: (el: HTMLElement) => {\n          el.style.maxHeight = `${el.offsetHeight}px`\n          el.style.overflow = 'hidden'\n        },\n        leave: (el: HTMLElement) => {\n          el.style.maxHeight = '0'\n        },\n        afterLeave(el: HTMLElement) {\n          el.style.maxHeight = ''\n          el.style.overflow = ''\n        },\n      }\n    : {\n        enter(el: HTMLElement) {\n          requestAnimationFrame(() => {\n            el.dataset.height = el.offsetHeight.toString()\n            el.style.maxHeight = '0'\n            void el.offsetHeight\n            el.style.maxHeight = `${el.dataset.height}px`\n            el.style.overflow = 'hidden'\n          })\n        },\n        afterEnter(el: HTMLElement) {\n          el.style.maxHeight = ''\n          el.style.overflow = ''\n        },\n        enterCancelled(el: HTMLElement) {\n          el.style.maxHeight = ''\n          el.style.overflow = ''\n        },\n        beforeLeave(el: HTMLElement) {\n          el.style.maxHeight = `${el.offsetHeight}px`\n          el.style.overflow = 'hidden'\n        },\n        leave(el: HTMLElement) {\n          el.style.maxHeight = '0'\n        },\n        afterLeave(el: HTMLElement) {\n          el.style.maxHeight = ''\n          el.style.overflow = ''\n        },\n        leaveCancelled(el: HTMLElement) {\n          el.style.maxHeight = ''\n          el.style.overflow = ''\n        },\n      }\n})\n\nconst transitionClass = computed(() => {\n  return rootMenu.isMenuPopup\n    ? {\n        enterActiveClass: 'ease-in-out duration-300',\n        enterFromClass: 'opacity-0 translate-x-4',\n        enterToClass: 'opacity-100',\n        leaveActiveClass: 'ease-in-out duration-300',\n        leaveFromClass: 'opacity-100',\n        leaveToClass: 'opacity-0',\n      }\n    : {\n        enterActiveClass: 'ease-in-out duration-300',\n        enterFromClass: 'opacity-0 translate-y-4 scale-95 blur-4',\n        enterToClass: 'opacity-100 translate-y-0 scale-100 blur-0',\n        leaveActiveClass: 'ease-in-out duration-300',\n        leaveFromClass: 'opacity-100 translate-y-0 scale-100 blur-0',\n        leaveToClass: 'opacity-0 translate-y-4 scale-95 blur-4',\n      }\n})\n\nconst hasChildren = computed(() => {\n  let flag = true\n  if (props.menu.children) {\n    if (props.menu.children.every((item: any) => item.meta?.menu === false)) {\n      flag = false\n    }\n  }\n  else {\n    flag = false\n  }\n  return flag\n})\n\nfunction handleClick() {\n  if (alwaysOpened.value) {\n    return\n  }\n  if (rootMenu.isMenuPopup && hasChildren.value) {\n    return\n  }\n  if (hasChildren.value) {\n    rootMenu.handleSubMenuClick(index, props.uniqueKey)\n  }\n  else {\n    rootMenu.handleMenuItemClick(index)\n  }\n}\n\nlet timeout: (() => void) | undefined\n\nfunction handleMouseenter() {\n  if (!rootMenu.isMenuPopup) {\n    return\n  }\n  rootMenu.mouseInMenu = props.uniqueKey\n  timeout?.()\n  ;({ stop: timeout } = useTimeoutFn(() => {\n    if (hasChildren.value) {\n      rootMenu.openMenu(index, props.uniqueKey)\n      nextTick(() => {\n        const el = itemRef.value?.ref\n        const subMenuEl = subMenuRef.value?.$el\n        if (!el || !subMenuEl) {\n          return\n        }\n        let top = 0\n        let left = 0\n        if (rootMenu.props.mode === 'vertical' || props.level !== 0) {\n          top = el.getBoundingClientRect().top + el.scrollTop\n          top -= (4 + 1) // 4px是菜单项的padding，1px是菜单项的border，目的是让菜单与上级菜单视觉上对齐\n          left = (rootMenu.props.direction === 'ltr' ? el.getBoundingClientRect().left : document.documentElement.clientWidth - el.getBoundingClientRect().right) + el.getBoundingClientRect().width\n          left += 4\n          if (top + subMenuEl.offsetHeight > window.innerHeight) {\n            top = window.innerHeight - subMenuEl.offsetHeight\n          }\n        }\n        else {\n          top = el.getBoundingClientRect().top + el.getBoundingClientRect().height\n          top += (4 - 1)\n          left = rootMenu.props.direction === 'ltr' ? el.getBoundingClientRect().left : document.documentElement.clientWidth - el.getBoundingClientRect().right\n          left -= (4 + 1)\n          if (top + subMenuEl.offsetHeight > window.innerHeight) {\n            subMenuEl.style.height = `${window.innerHeight - top}px`\n          }\n        }\n        if (left + subMenuEl.offsetWidth > document.documentElement.clientWidth) {\n          left = (rootMenu.props.direction === 'ltr' ? el.getBoundingClientRect().left : document.documentElement.clientWidth - el.getBoundingClientRect().right) - el.getBoundingClientRect().width\n        }\n        subMenuEl.style.top = `${top}px`\n        subMenuEl.style.insetInlineStart = `${left}px`\n      })\n    }\n    else {\n      const path = props.menu.children ? rootMenu.subMenus[index].indexPath.at(-1)! : rootMenu.items[index].indexPath.at(-1)!\n      rootMenu.openMenu(path, rootMenu.subMenus[path].indexPath)\n    }\n  }, 300))\n}\n\nfunction handleMouseleave() {\n  if (!rootMenu.isMenuPopup) {\n    return\n  }\n  rootMenu.mouseInMenu = []\n  timeout?.()\n  ;({ stop: timeout } = useTimeoutFn(() => {\n    if (rootMenu.mouseInMenu.length === 0) {\n      rootMenu.closeMenu(props.uniqueKey)\n    }\n    else {\n      if (hasChildren.value) {\n        !rootMenu.mouseInMenu.includes(props.uniqueKey.at(-1)!) && rootMenu.closeMenu(props.uniqueKey.at(-1)!)\n      }\n    }\n  }, 300))\n}\n</script>\n\n<template>\n  <Item ref=\"itemRef\" :unique-key=\"uniqueKey\" :item=\"menu\" :level=\"level\" :sub-menu=\"hasChildren\" :expand=\"opened\" :always-expand=\"alwaysOpened\" @click=\"handleClick\" @mouseenter=\"handleMouseenter\" @mouseleave=\"handleMouseleave\" />\n  <Teleport v-if=\"hasChildren\" to=\"body\" :disabled=\"!rootMenu.isMenuPopup\">\n    <Transition v-bind=\"transitionClass\" v-on=\"transitionEvent\">\n      <FaScrollArea\n        v-if=\"opened\" ref=\"subMenuRef\" :scrollbar=\"false\" :mask=\"rootMenu.isMenuPopup\" class=\"sub-menu static rounded-lg\" :class=\"{\n          'bg-[var(--g-sub-sidebar-bg)]': rootMenu.isMenuPopup,\n          'border shadow-xl fixed! z-3000 w-[200px]': rootMenu.isMenuPopup,\n          'py-1': rootMenu.isMenuPopup,\n        }\"\n      >\n        <template v-for=\"item in menu.children\" :key=\"item.path ?? JSON.stringify(item)\">\n          <SubMenu v-if=\"item.meta?.menu !== false\" :unique-key=\"[...uniqueKey, item.path ?? JSON.stringify(item)]\" :menu=\"item\" :level=\"level + 1\" />\n        </template>\n      </FaScrollArea>\n    </Transition>\n  </Teleport>\n</template>\n"],"names":["props","__props","index","itemRef","useTemplateRef","subMenuRef","rootMenu","inject","rootMenuInjectionKey","opened","computed","alwaysOpened","transitionEvent","el","transitionClass","hasChildren","flag","item","_a","handleClick","timeout","handleMouseenter","useTimeoutFn","nextTick","subMenuEl","_b","top","left","path","handleMouseleave"],"mappings":"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"}